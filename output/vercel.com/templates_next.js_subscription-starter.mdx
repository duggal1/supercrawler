---
title: Stripe Subion Starter
description: No description
keywords: No keywords
canonicalUrl: https://vercel.com/templates/next.js/subion-starter
---

## Table of Contents

{/* Auto-generated table of contents */}

[Skip to content](#geist-skip-)

* ProductsDX Platform[Previews Helping teams ship 6Ã— faster](/products/previews)[AI Powering breakthroughs](/ai)Managed Infrastructure[Fluid compute Servers, in serverless form](/fluid)[Rendering Fast, scalable, and reliable](/products/rendering)[Observability Trace every step](/products/observability)[Security Scale without compromising](/security)Open Source[Next.js The native Next.js platform](/frameworks/nextjs)[Turborepo Speed with Enterprise scale](/solutions/turborepo)[AI SDK The AI Toolkit for Type](https://sdk.vercel.ai/)
* DX Platform[Previews Helping teams ship 6Ã— faster](/products/previews)[AI Powering breakthroughs](/ai)
* [Previews Helping teams ship 6Ã— faster](/products/previews)
* [AI Powering breakthroughs](/ai)
* Managed Infrastructure[Fluid compute Servers, in serverless form](/fluid)[Rendering Fast, scalable, and reliable](/products/rendering)[Observability Trace every step](/products/observability)[Security Scale without compromising](/security)
* [Fluid compute Servers, in serverless form](/fluid)
* [Rendering Fast, scalable, and reliable](/products/rendering)
* [Observability Trace every step](/products/observability)
* [Security Scale without compromising](/security)
* Open Source[Next.js The native Next.js platform](/frameworks/nextjs)[Turborepo Speed with Enterprise scale](/solutions/turborepo)[AI SDK The AI Toolkit for Type](https://sdk.vercel.ai/)
* [Next.js The native Next.js platform](/frameworks/nextjs)
* [Turborepo Speed with Enterprise scale](/solutions/turborepo)
* [AI SDK The AI Toolkit for Type](https://sdk.vercel.ai/)
* SolutionsUse Cases[AI Apps Deploy at the speed of AI](/solutions/ai-apps)[Composable Commerce Power storefronts that convert](/solutions/composable-commerce)[Marketing Sites Launch campaigns fast](/solutions/marketing-sites)[Multi-tenant Platforms Scale apps with one codebase](/solutions/multi-tenant-saas)[Web Apps Ship features, not infrastructure](/solutions/web-apps)Users[Platform Engineers Automate away repetition](/solutions/platform-engineering)[Design Engineers Deploy for every idea](/solutions/design-engineering)
* Use Cases[AI Apps Deploy at the speed of AI](/solutions/ai-apps)[Composable Commerce Power storefronts that convert](/solutions/composable-commerce)[Marketing Sites Launch campaigns fast](/solutions/marketing-sites)[Multi-tenant Platforms Scale apps with one codebase](/solutions/multi-tenant-saas)[Web Apps Ship features, not infrastructure](/solutions/web-apps)
* [AI Apps Deploy at the speed of AI](/solutions/ai-apps)
* [Composable Commerce Power storefronts that convert](/solutions/composable-commerce)
* [Marketing Sites Launch campaigns fast](/solutions/marketing-sites)
* [Multi-tenant Platforms Scale apps with one codebase](/solutions/multi-tenant-saas)
* [Web Apps Ship features, not infrastructure](/solutions/web-apps)
* Users[Platform Engineers Automate away repetition](/solutions/platform-engineering)[Design Engineers Deploy for every idea](/solutions/design-engineering)
* [Platform Engineers Automate away repetition](/solutions/platform-engineering)
* [Design Engineers Deploy for every idea](/solutions/design-engineering)
* ResourcesTools[Resource Center Todayâ€™s best practices](/resources)[Marketplace Extend and automate workflows](/marketplace)[Templates Jumpstart app development](/templates)[Guides Find help quickly](/guides)[Partner Finder Get help from solution partners](/partners/solution-partners)Company[Customers Trusted by the best teams](/customers)[Blog The latest posts and changes](/blog)[Changelog See what shipped](/changelog)[Press Read the latest news](/press)
* Tools[Resource Center Todayâ€™s best practices](/resources)[Marketplace Extend and automate workflows](/marketplace)[Templates Jumpstart app development](/templates)[Guides Find help quickly](/guides)[Partner Finder Get help from solution partners](/partners/solution-partners)
* [Resource Center Todayâ€™s best practices](/resources)
* [Marketplace Extend and automate workflows](/marketplace)
* [Templates Jumpstart app development](/templates)
* [Guides Find help quickly](/guides)
* [Partner Finder Get help from solution partners](/partners/solution-partners)
* Company[Customers Trusted by the best teams](/customers)[Blog The latest posts and changes](/blog)[Changelog See what shipped](/changelog)[Press Read the latest news](/press)
* [Customers Trusted by the best teams](/customers)
* [Blog The latest posts and changes](/blog)
* [Changelog See what shipped](/changelog)
* [Press Read the latest news](/press)
* [Enterprise](/enterprise)
* [Docs](/docs)
* [Pricing](/pricing)

[Log In](/login)

[Contact](/contact)

[Sign Up](/signup)

[â† Back to Templates](/templates)

[vercel/nextjs-subion-payments](https://github.com/vercel/nextjs-subion-payments)

# Stripe Subion Starter

The all-in-one subion starter kit for high-performance SaaS applications, powered by Stripe, Supabase, and Vercel.

[Deploy](/new/clone?demo-deion=The%20all-in-one%20subion%20starter%20kit%20for%20high-performance%20SaaS%20applications%2C%20powered%20by%20Stripe%2C%20Supabase%2C%20and%20Vercel.&demo-image=%2F%2Fimages.ctfassets.net%2Fe5382hct74si%2F7segt6pEQeFpvw4KiMND8%2F7d9ce0dbc600aeb8890d39ec892cb8f0%2FNew_Project__3_.png&demo-title=Stripe%20Subion%20Starter&demo-url=https%3A%2F%2Fsubion-payments.vercel.app%2F&env=NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY%2CSTRIPE_SECRET_KEY%2CSTRIPE_WEBHOOK_SECRET&envDeion=How%20to%20get%20these%20env%20variables%3A&envLink=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments%2Fblob%2Fmain%2F.env.local.example&external-id=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments%2Ftree%2Fmain&from=templates&project-name=Stripe%20Subion%20Starter&repository-name=subion-starter&repository-url=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments&stores=%5B%7B%22type%22%3A%22integration%22%2C%22integrationSlug%22%3A%22supabase%22%2C%22productSlug%22%3A%22supabase%22%7D%5D)

[View Demo](https://subion-payments.vercel.app/)

[Next.js](/templates/next.js)

[Ecommerce](/templates/ecommerce)

[SaaS](/templates/saas)

[Authentication](/templates/authentication)

[Tailwind](/templates/tailwind)

[Supabase](/templates/supabase)

[Supabase Auth](/templates/supabase-auth)

![Subion Payments Starter](/_next/image?url=https%3A%2F%2Fimages.ctfassets.net%2Fe5382hct74si%2F7segt6pEQeFpvw4KiMND8%2F7d9ce0dbc600aeb8890d39ec892cb8f0%2FNew_Project__3_.png&w=3840&q=75)

## Next.js Subion Payments Starter

> [!WARNING]This repo has been sunset and replaced by a new template:[https://github.com/nextjs/saas-starter](https://github.com/nextjs/saas-starter)
>

### Features

* Secure user management and authentication with[Supabase](https://supabase.io/docs/guides/auth)
* Powerful data access & management tooling on top of PostgreSQL with[Supabase](https://supabase.io/docs/guides/database)
* Integration with[Stripe Checkout](https://stripe.com/docs/payments/checkout)and the[Stripe customer portal](https://stripe.com/docs/billing/subions/customer-portal)
* Automatic syncing of pricing plans and subion statuses via[Stripe webhooks](https://stripe.com/docs/webhooks)

### Demo

* [https://subion-payments.vercel.app/](https://subion-payments.vercel.app/)

[](https://subion-payments.vercel.app/)

### Architecture

### Step-by-step setup

When deploying this template, the sequence of steps is important. Follow the steps below in order to get up and running.

#### Initiate Deployment

[](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments&env=NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,STRIPE_SECRET_KEY&envDeion=Enter%20your%20Stripe%20API%20keys.&envLink=https%3A%2F%2Fdashboard.stripe.com%2Fapikeys&project-name=nextjs-subion-payments&repository-name=nextjs-subion-payments&integration-ids=oac_VqOgBHqhEoFTPzGkPd7L0iH6&external-id=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments%2Ftree%2Fmain)

The Vercel Deployment will create a new repository with this template on your GitHub account and guide you through a new Supabase project creation. The[Supabase Vercel Deploy Integration](https://vercel.com/integrations/supabase)will set up the necessary Supabase environment variables and run the[SQL migrations](https://github.com/vercel/nextjs-subion-payments/tree/main/./supabase/migrations/20230530034630_init.sql)to set up the Database schema on your account. You can inspect the created tables in your project's[Table editor](https://app.supabase.com/project/_/editor).

Should the automatic setup fail, please[create a Supabase account](https://app.supabase.com/projects), and a new project if needed. In your project, igate to the[SQL editor](https://app.supabase.com/project/_/sql)and select the "Stripe Subions" starter template from the Quick start section.

#### Configure Auth

Follow[this guide](https://supabase.com/docs/guides/auth/social-login/auth-github)to set up an OAuth app with GitHub and configure Supabase to use it as an auth provider.

In your Supabase project, igate to[auth > URL configuration](https://app.supabase.com/project/_/auth/url-configuration)and set your main production URL (e.g.[https://your-deployment-url.vercel.app](https://your-deployment-url.vercel.app)) as the site url.

Next, in your Vercel deployment settings, add a new**Production**environment variable called`NEXT_PUBLIC_SITE_URL`and set it to the same URL. Make sure to deselect preview and development environments to make sure that preview branches and local development work correctly.

If you've deployed this template via the "Deploy to Vercel" button above, you can skip this step. The Supabase Vercel Integration will have set redirect wildcards for you. You can check this by going to your Supabase[auth settings](https://app.supabase.com/project/_/auth/url-configuration)and you should see a list of redirects under "Redirect URLs".

Otherwise, for auth redirects (email confirmations, magic links, OAuth providers) to work correctly in deploy previews, igate to the[auth settings](https://app.supabase.com/project/_/auth/url-configuration)and add the following wildcard URL to "Redirect URLs":`https://*-username.vercel.app/**`. You can read more about redirect wildcard patterns in the[docs](https://supabase.com/docs/guides/auth#redirect-urls-and-wildcards).

If you've deployed this template via the "Deploy to Vercel" button above, you can skip this step. The Supabase Vercel Integration will have run database migrations for you. You can check this by going to[the Table Editor for your Supabase project](https://supabase.com/dashboard/project/_/editor), and confirming there are tables with seed data.

Otherwise, igate to the[SQL Editor](https://supabase.com/dashboard/project/_/sql/new), paste the contents of[the Supabase  schema.sql  file](https://github.com/vercel/nextjs-subion-payments/tree/main/./schema.sql), and click RUN to initialize the database.

If you've deployed this template via the "Deploy to Vercel" button above, you can skip this step. The Supabase Vercel Integration will have set your environment variables for you. You can check this by going to your Vercel project settings, and clicking on 'Environment variables', there will be a list of environment variables with the Supabase icon displayed next to them.

Otherwise igate to the[API settings](https://app.supabase.com/project/_/settings/api)and paste them into the Vercel deployment interface. Copy project API keys and paste into the`NEXT_PUBLIC_SUPABASE_ANON_KEY`and`SUPABASE_SERVICE_ROLE_KEY`fields, and copy the project URL and paste to Vercel as`NEXT_PUBLIC_SUPABASE_URL`.

Congrats, this completes the Supabase setup, almost there!

#### Configure Stripe

Next, we'll need to configure[Stripe](https://stripe.com/)to handle test payments. If you don't already have a Stripe account, create one now.

For the following steps, make sure you have the["Test Mode" toggle](https://stripe.com/docs/testing)switched on.

We need to create a webhook in the`Developers`section of Stripe. Pictured in the architecture diagram above, this webhook is the piece that connects Stripe to your Vercel Serverless Functions.

1. Click the "Add Endpoint" button on the[test Endpoints page](https://dashboard.stripe.com/test/webhooks).
1. Enter your production deployment URL followed by`/api/webhooks`for the endpoint URL. (e.g.`https://your-deployment-url.vercel.app/api/webhooks`)
1. Click`Select events`under the`Select events to listen to`heading.
1. Click`Select all events`in the`Select events to send`section.
1. Copy`Signing secret`as we'll need that in the next step (e.g`whsec_xxx`) (/!\ be careful not to copy the webook id we_xxxx).
1. In addition to the`NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`and the`STRIPE_SECRET_KEY`we've set earlier during deployment, we need to add the webhook secret as`STRIPE_WEBHOOK_SECRET`env var.

For the newly set environment variables to take effect and everything to work together correctly, we need to redeploy our app in Vercel. In your Vercel Dashboard, igate to deployments, click the overflow menu button and select "Redeploy" (do NOT enable the "Use existing Build Cache" option). Once Vercel has rebuilt and redeployed your app, you're ready to set up your products and prices.

Your application's webhook listens for product updates on Stripe and automatically propagates them to your Supabase database. So with your webhook listener running, you can now create your product and pricing information in the[Stripe Dashboard](https://dashboard.stripe.com/test/products).

Stripe Checkout currently supports pricing that bills a predefined amount at a specific interval. More complex plans (e.g., different pricing tiers or seats) are not yet supported.

For example, you can create business models with different pricing tiers, e.g.:

* Product 1: HobbyPrice 1: 10 USD per monthPrice 2: 100 USD per year
* Price 1: 10 USD per month
* Price 2: 100 USD per year
* Product 2: FreelancerPrice 1: 20 USD per monthPrice 2: 200 USD per year
* Price 1: 20 USD per month
* Price 2: 200 USD per year

Optionally, to speed up the setup, we have added a[fixtures file](https://github.com/vercel/nextjs-subion-payments/tree/main/)to bootstrap test product and pricing data in your Stripe account. The[Stripe CLI](https://stripe.com/docs/stripe-cli#install)`fixtures`command executes a series of API requests defined in this JSON file. Simply run`stripe fixtures fixtures/stripe-fixtures.json`.

**Important:**Make sure that you've configured your Stripe webhook correctly and redeployed with all needed environment variables.

1. Set your custom branding in the[settings](https://dashboard.stripe.com/settings/branding)
1. Configure the Customer Portal[settings](https://dashboard.stripe.com/test/settings/billing/portal)
1. Toggle on "Allow customers to update their payment methods"
1. Toggle on "Allow customers to update subions"
1. Toggle on "Allow customers to cancel subions"
1. Add the products and prices that you want
1. Set up the required business information and links

#### That's it

I know, that was quite a lot to get through, but it's worth it. You're now ready to earn recurring revenue from your customers. ðŸ¥³

### Develop locally

If you haven't already done so, clone your Github repository to your local machine.

#### Install dependencies

Ensure you have[pnpm](https://pnpm.io/installation)installed and run:

```
pnpm install
```

Next, use the[Vercel CLI](https://vercel.com/docs/cli)to link your project:

```
pnpm dlx vercel login
pnpm dlx vercel link
```

`pnpm dlx`runs a package from the registry, without installing it as a dependency. Alternatively, you can install these packages globally, and drop the`pnpm dlx`part.

If you don't intend to use a local Supabase instance for development and testing, you can use the Vercel CLI to download the development env vars:

```
pnpm dlx vercel env pull
.
env
.
local
```

Running this command will create a new`.env.local`file in your project folder. For security purposes, you will need to set the`SUPABASE_SERVICE_ROLE_KEY`manually from your[Supabase dashboard](https://app.supabase.io/)(`Settings > API`). If you are not using a local Supabase instance, you should also change the`--local`flag to`--linked' or '--project-id <string>' in the`supabase:generate-types`in`package.json`.(see ->[https://supabase.com/docs/reference/cli/supabase-gen-types-type])

#### Local development with Supabase

It's highly recommended to use a local Supabase instance for development and testing. We have provided a set of custom commands for this in`package.json`.

First, you will need to install[Docker](https://www.docker.com/get-started/). You should also copy or rename:

* `.env.local.example`->`.env.local`
* `.env.example`->`.env`

Next, run the following command to start a local Supabase instance and run the migrations to set up the database schema:

```
pnpm supabase
:
start
```

The terminal output will provide you with URLs to access the different services within the Supabase stack. The Supabase Studio is where you can make changes to your local database instance.

Copy the value for the`service_role_key`and paste it as the value for the`SUPABASE_SERVICE_ROLE_KEY`in your`.env.local`file.

You can print out these URLs at any time with the following command:

```
pnpm supabase
:
status
```

To link your local Supabase instance to your project, run the following command, igate to the Supabase project you created above, and enter your database password.

```
pnpm supabase
:
link
```

If you need to reset your database password, head over to[your database settings](https://supabase.com/dashboard/project/_/settings/database)and click "Reset database password", and this time copy it across to a password manager! ðŸ˜„

ðŸš§ Warning: This links our Local Development instance to the project we are using for`production`. Currently, it only has test records, but once it has customer data, we recommend using[Branching](https://supabase.com/docs/guides/platform/branching)or manually creating a separate`preview`or`staging`environment, to ensure your customer's data is not used locally, and schema changes/migrations can be thoroughly tested before shipping to`production`.

Once you've linked your project, you can pull down any schema changes you made in your remote database with:

```
pnpm supabase
:
pull
```

You can seed your local database with any data you added in your remote database with:

```
pnpm supabase
:
generate
-
seed
pnpm supabase
:
reset
```

ðŸš§ Warning: this is seeding data from the`production`database. Currently, this only contains test data, but we recommend using[Branching](https://supabase.com/docs/guides/platform/branching)or manually setting up a`preview`or`staging`environment once this contains real customer data.

You can make changes to the database schema in your local Supabase Studio and run the following command to generate Type types to match your schema:

```
pnpm supabase
:
generate
-
types
```

You can also automatically generate a migration file with all the changes you've made to your local database schema with the following command:

```
pnpm supabase
:
generate
-
migration
```

And push those changes to your remote database with:

```
pnpm supabase
:
push
```

Remember to test your changes thoroughly in your`local`and`staging`or`preview`environments before deploying them to`production`!

#### Use the Stripe CLI to test webhooks

Use the[Stripe CLI](https://stripe.com/docs/stripe-cli)to[login to your Stripe account](https://stripe.com/docs/stripe-cli#login-account):

```
pnpm stripe
:
login
```

This will print a URL to igate to in your browser and provide access to your Stripe account.

Next, start local webhook forwarding:

```
pnpm stripe
:
listen
```

Running this Stripe command will print a webhook secret (such as,`whsec_***`) to the console. Set`STRIPE_WEBHOOK_SECRET`to this value in your`.env.local`file. If you haven't already, you should also set`NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`and`STRIPE_SECRET_KEY`in your`.env.local`file using the**test mode**(!) keys from your Stripe dashboard.

#### Run the Next.js client

In a separate terminal, run the following command to start the development server:

```
pnpm dev
```

Note that webhook forwarding and the development server must be running concurrently in two separate terminals for the application to work correctly.

Finally, igate to[http://localhost:3000](http://localhost:3000)in your browser to see the application rendered.

### Going live

#### Archive testing products

Archive all test mode Stripe products before going live. Before creating your live mode products, make sure to follow the steps below to set up your live mode env vars and webhooks.

#### Configure production environment variables

To run the project in live mode and process payments with Stripe, switch Stripe from "test mode" to "production mode." Your Stripe API keys will be different in production mode, and you will have to create a separate production mode webhook. Copy these values and paste them into Vercel, replacing the test mode values.

#### Redeploy

Afterward, you will need to rebuild your production deployment for the changes to take effect. Within your project Dashboard, igate to the "Deployments" tab, select the most recent deployment, click the overflow menu button (next to the "Visit" button) and select "Redeploy" (do NOT enable the "Use existing Build Cache" option).

To verify you are running in production mode, test checking out with the[Stripe test card](https://stripe.com/docs/testing). The test card should not work.

[â† Back to Templates](/templates)

![Subion Payments Starter](/_next/image?url=https%3A%2F%2Fimages.ctfassets.net%2Fe5382hct74si%2F7segt6pEQeFpvw4KiMND8%2F7d9ce0dbc600aeb8890d39ec892cb8f0%2FNew_Project__3_.png&w=3840&q=75)

[vercel/nextjs-subion-payments](https://github.com/vercel/nextjs-subion-payments)

# Stripe Subion Starter

The all-in-one subion starter kit for high-performance SaaS applications, powered by Stripe, Supabase, and Vercel.

[Deploy](/new/clone?demo-deion=The%20all-in-one%20subion%20starter%20kit%20for%20high-performance%20SaaS%20applications%2C%20powered%20by%20Stripe%2C%20Supabase%2C%20and%20Vercel.&demo-image=%2F%2Fimages.ctfassets.net%2Fe5382hct74si%2F7segt6pEQeFpvw4KiMND8%2F7d9ce0dbc600aeb8890d39ec892cb8f0%2FNew_Project__3_.png&demo-title=Stripe%20Subion%20Starter&demo-url=https%3A%2F%2Fsubion-payments.vercel.app%2F&env=NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY%2CSTRIPE_SECRET_KEY%2CSTRIPE_WEBHOOK_SECRET&envDeion=How%20to%20get%20these%20env%20variables%3A&envLink=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments%2Fblob%2Fmain%2F.env.local.example&external-id=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments%2Ftree%2Fmain&from=templates&project-name=Stripe%20Subion%20Starter&repository-name=subion-starter&repository-url=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments&stores=%5B%7B%22type%22%3A%22integration%22%2C%22integrationSlug%22%3A%22supabase%22%2C%22productSlug%22%3A%22supabase%22%7D%5D)

[View Demo](https://subion-payments.vercel.app/)

[Next.js](/templates/next.js)

[Ecommerce](/templates/ecommerce)

[SaaS](/templates/saas)

[Authentication](/templates/authentication)

[Tailwind](/templates/tailwind)

[Supabase](/templates/supabase)

[Supabase Auth](/templates/supabase-auth)

## Next.js Subion Payments Starter

> [!WARNING]This repo has been sunset and replaced by a new template:[https://github.com/nextjs/saas-starter](https://github.com/nextjs/saas-starter)
>

### Features

* Secure user management and authentication with[Supabase](https://supabase.io/docs/guides/auth)
* Powerful data access & management tooling on top of PostgreSQL with[Supabase](https://supabase.io/docs/guides/database)
* Integration with[Stripe Checkout](https://stripe.com/docs/payments/checkout)and the[Stripe customer portal](https://stripe.com/docs/billing/subions/customer-portal)
* Automatic syncing of pricing plans and subion statuses via[Stripe webhooks](https://stripe.com/docs/webhooks)

### Demo

* [https://subion-payments.vercel.app/](https://subion-payments.vercel.app/)

[](https://subion-payments.vercel.app/)

### Architecture

### Step-by-step setup

When deploying this template, the sequence of steps is important. Follow the steps below in order to get up and running.

#### Initiate Deployment

[](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments&env=NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,STRIPE_SECRET_KEY&envDeion=Enter%20your%20Stripe%20API%20keys.&envLink=https%3A%2F%2Fdashboard.stripe.com%2Fapikeys&project-name=nextjs-subion-payments&repository-name=nextjs-subion-payments&integration-ids=oac_VqOgBHqhEoFTPzGkPd7L0iH6&external-id=https%3A%2F%2Fgithub.com%2Fvercel%2Fnextjs-subion-payments%2Ftree%2Fmain)

The Vercel Deployment will create a new repository with this template on your GitHub account and guide you through a new Supabase project creation. The[Supabase Vercel Deploy Integration](https://vercel.com/integrations/supabase)will set up the necessary Supabase environment variables and run the[SQL migrations](https://github.com/vercel/nextjs-subion-payments/tree/main/./supabase/migrations/20230530034630_init.sql)to set up the Database schema on your account. You can inspect the created tables in your project's[Table editor](https://app.supabase.com/project/_/editor).

Should the automatic setup fail, please[create a Supabase account](https://app.supabase.com/projects), and a new project if needed. In your project, igate to the[SQL editor](https://app.supabase.com/project/_/sql)and select the "Stripe Subions" starter template from the Quick start section.

#### Configure Auth

Follow[this guide](https://supabase.com/docs/guides/auth/social-login/auth-github)to set up an OAuth app with GitHub and configure Supabase to use it as an auth provider.

In your Supabase project, igate to[auth > URL configuration](https://app.supabase.com/project/_/auth/url-configuration)and set your main production URL (e.g.[https://your-deployment-url.vercel.app](https://your-deployment-url.vercel.app)) as the site url.

Next, in your Vercel deployment settings, add a new**Production**environment variable called`NEXT_PUBLIC_SITE_URL`and set it to the same URL. Make sure to deselect preview and development environments to make sure that preview branches and local development work correctly.

If you've deployed this template via the "Deploy to Vercel" button above, you can skip this step. The Supabase Vercel Integration will have set redirect wildcards for you. You can check this by going to your Supabase[auth settings](https://app.supabase.com/project/_/auth/url-configuration)and you should see a list of redirects under "Redirect URLs".

Otherwise, for auth redirects (email confirmations, magic links, OAuth providers) to work correctly in deploy previews, igate to the[auth settings](https://app.supabase.com/project/_/auth/url-configuration)and add the following wildcard URL to "Redirect URLs":`https://*-username.vercel.app/**`. You can read more about redirect wildcard patterns in the[docs](https://supabase.com/docs/guides/auth#redirect-urls-and-wildcards).

If you've deployed this template via the "Deploy to Vercel" button above, you can skip this step. The Supabase Vercel Integration will have run database migrations for you. You can check this by going to[the Table Editor for your Supabase project](https://supabase.com/dashboard/project/_/editor), and confirming there are tables with seed data.

Otherwise, igate to the[SQL Editor](https://supabase.com/dashboard/project/_/sql/new), paste the contents of[the Supabase  schema.sql  file](https://github.com/vercel/nextjs-subion-payments/tree/main/./schema.sql), and click RUN to initialize the database.

If you've deployed this template via the "Deploy to Vercel" button above, you can skip this step. The Supabase Vercel Integration will have set your environment variables for you. You can check this by going to your Vercel project settings, and clicking on 'Environment variables', there will be a list of environment variables with the Supabase icon displayed next to them.

Otherwise igate to the[API settings](https://app.supabase.com/project/_/settings/api)and paste them into the Vercel deployment interface. Copy project API keys and paste into the`NEXT_PUBLIC_SUPABASE_ANON_KEY`and`SUPABASE_SERVICE_ROLE_KEY`fields, and copy the project URL and paste to Vercel as`NEXT_PUBLIC_SUPABASE_URL`.

Congrats, this completes the Supabase setup, almost there!

#### Configure Stripe

Next, we'll need to configure[Stripe](https://stripe.com/)to handle test payments. If you don't already have a Stripe account, create one now.

For the following steps, make sure you have the["Test Mode" toggle](https://stripe.com/docs/testing)switched on.

We need to create a webhook in the`Developers`section of Stripe. Pictured in the architecture diagram above, this webhook is the piece that connects Stripe to your Vercel Serverless Functions.

1. Click the "Add Endpoint" button on the[test Endpoints page](https://dashboard.stripe.com/test/webhooks).
1. Enter your production deployment URL followed by`/api/webhooks`for the endpoint URL. (e.g.`https://your-deployment-url.vercel.app/api/webhooks`)
1. Click`Select events`under the`Select events to listen to`heading.
1. Click`Select all events`in the`Select events to send`section.
1. Copy`Signing secret`as we'll need that in the next step (e.g`whsec_xxx`) (/!\ be careful not to copy the webook id we_xxxx).
1. In addition to the`NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`and the`STRIPE_SECRET_KEY`we've set earlier during deployment, we need to add the webhook secret as`STRIPE_WEBHOOK_SECRET`env var.

For the newly set environment variables to take effect and everything to work together correctly, we need to redeploy our app in Vercel. In your Vercel Dashboard, igate to deployments, click the overflow menu button and select "Redeploy" (do NOT enable the "Use existing Build Cache" option). Once Vercel has rebuilt and redeployed your app, you're ready to set up your products and prices.

Your application's webhook listens for product updates on Stripe and automatically propagates them to your Supabase database. So with your webhook listener running, you can now create your product and pricing information in the[Stripe Dashboard](https://dashboard.stripe.com/test/products).

Stripe Checkout currently supports pricing that bills a predefined amount at a specific interval. More complex plans (e.g., different pricing tiers or seats) are not yet supported.

For example, you can create business models with different pricing tiers, e.g.:

* Product 1: HobbyPrice 1: 10 USD per monthPrice 2: 100 USD per year
* Price 1: 10 USD per month
* Price 2: 100 USD per year
* Product 2: FreelancerPrice 1: 20 USD per monthPrice 2: 200 USD per year
* Price 1: 20 USD per month
* Price 2: 200 USD per year

Optionally, to speed up the setup, we have added a[fixtures file](https://github.com/vercel/nextjs-subion-payments/tree/main/)to bootstrap test product and pricing data in your Stripe account. The[Stripe CLI](https://stripe.com/docs/stripe-cli#install)`fixtures`command executes a series of API requests defined in this JSON file. Simply run`stripe fixtures fixtures/stripe-fixtures.json`.

**Important:**Make sure that you've configured your Stripe webhook correctly and redeployed with all needed environment variables.

1. Set your custom branding in the[settings](https://dashboard.stripe.com/settings/branding)
1. Configure the Customer Portal[settings](https://dashboard.stripe.com/test/settings/billing/portal)
1. Toggle on "Allow customers to update their payment methods"
1. Toggle on "Allow customers to update subions"
1. Toggle on "Allow customers to cancel subions"
1. Add the products and prices that you want
1. Set up the required business information and links

#### That's it

I know, that was quite a lot to get through, but it's worth it. You're now ready to earn recurring revenue from your customers. ðŸ¥³

### Develop locally

If you haven't already done so, clone your Github repository to your local machine.

#### Install dependencies

Ensure you have[pnpm](https://pnpm.io/installation)installed and run:

```
pnpm install
```

Next, use the[Vercel CLI](https://vercel.com/docs/cli)to link your project:

```
pnpm dlx vercel login
pnpm dlx vercel link
```

`pnpm dlx`runs a package from the registry, without installing it as a dependency. Alternatively, you can install these packages globally, and drop the`pnpm dlx`part.

If you don't intend to use a local Supabase instance for development and testing, you can use the Vercel CLI to download the development env vars:

```
pnpm dlx vercel env pull
.
env
.
local
```

Running this command will create a new`.env.local`file in your project folder. For security purposes, you will need to set the`SUPABASE_SERVICE_ROLE_KEY`manually from your[Supabase dashboard](https://app.supabase.io/)(`Settings > API`). If you are not using a local Supabase instance, you should also change the`--local`flag to`--linked' or '--project-id <string>' in the`supabase:generate-types`in`package.json`.(see ->[https://supabase.com/docs/reference/cli/supabase-gen-types-type])

#### Local development with Supabase

It's highly recommended to use a local Supabase instance for development and testing. We have provided a set of custom commands for this in`package.json`.

First, you will need to install[Docker](https://www.docker.com/get-started/). You should also copy or rename:

* `.env.local.example`->`.env.local`
* `.env.example`->`.env`

Next, run the following command to start a local Supabase instance and run the migrations to set up the database schema:

```
pnpm supabase
:
start
```

The terminal output will provide you with URLs to access the different services within the Supabase stack. The Supabase Studio is where you can make changes to your local database instance.

Copy the value for the`service_role_key`and paste it as the value for the`SUPABASE_SERVICE_ROLE_KEY`in your`.env.local`file.

You can print out these URLs at any time with the following command:

```
pnpm supabase
:
status
```

To link your local Supabase instance to your project, run the following command, igate to the Supabase project you created above, and enter your database password.

```
pnpm supabase
:
link
```

If you need to reset your database password, head over to[your database settings](https://supabase.com/dashboard/project/_/settings/database)and click "Reset database password", and this time copy it across to a password manager! ðŸ˜„

ðŸš§ Warning: This links our Local Development instance to the project we are using for`production`. Currently, it only has test records, but once it has customer data, we recommend using[Branching](https://supabase.com/docs/guides/platform/branching)or manually creating a separate`preview`or`staging`environment, to ensure your customer's data is not used locally, and schema changes/migrations can be thoroughly tested before shipping to`production`.

Once you've linked your project, you can pull down any schema changes you made in your remote database with:

```
pnpm supabase
:
pull
```

You can seed your local database with any data you added in your remote database with:

```
pnpm supabase
:
generate
-
seed
pnpm supabase
:
reset
```

ðŸš§ Warning: this is seeding data from the`production`database. Currently, this only contains test data, but we recommend using[Branching](https://supabase.com/docs/guides/platform/branching)or manually setting up a`preview`or`staging`environment once this contains real customer data.

You can make changes to the database schema in your local Supabase Studio and run the following command to generate Type types to match your schema:

```
pnpm supabase
:
generate
-
types
```

You can also automatically generate a migration file with all the changes you've made to your local database schema with the following command:

```
pnpm supabase
:
generate
-
migration
```

And push those changes to your remote database with:

```
pnpm supabase
:
push
```

Remember to test your changes thoroughly in your`local`and`staging`or`preview`environments before deploying them to`production`!

#### Use the Stripe CLI to test webhooks

Use the[Stripe CLI](https://stripe.com/docs/stripe-cli)to[login to your Stripe account](https://stripe.com/docs/stripe-cli#login-account):

```
pnpm stripe
:
login
```

This will print a URL to igate to in your browser and provide access to your Stripe account.

Next, start local webhook forwarding:

```
pnpm stripe
:
listen
```

Running this Stripe command will print a webhook secret (such as,`whsec_***`) to the console. Set`STRIPE_WEBHOOK_SECRET`to this value in your`.env.local`file. If you haven't already, you should also set`NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`and`STRIPE_SECRET_KEY`in your`.env.local`file using the**test mode**(!) keys from your Stripe dashboard.

#### Run the Next.js client

In a separate terminal, run the following command to start the development server:

```
pnpm dev
```

Note that webhook forwarding and the development server must be running concurrently in two separate terminals for the application to work correctly.

Finally, igate to[http://localhost:3000](http://localhost:3000)in your browser to see the application rendered.

### Going live

#### Archive testing products

Archive all test mode Stripe products before going live. Before creating your live mode products, make sure to follow the steps below to set up your live mode env vars and webhooks.

#### Configure production environment variables

To run the project in live mode and process payments with Stripe, switch Stripe from "test mode" to "production mode." Your Stripe API keys will be different in production mode, and you will have to create a separate production mode webhook. Copy these values and paste them into Vercel, replacing the test mode values.

#### Redeploy

Afterward, you will need to rebuild your production deployment for the changes to take effect. Within your project Dashboard, igate to the "Deployments" tab, select the most recent deployment, click the overflow menu button (next to the "Visit" button) and select "Redeploy" (do NOT enable the "Use existing Build Cache" option).

To verify you are running in production mode, test checking out with the[Stripe test card](https://stripe.com/docs/testing). The test card should not work.

## Related Templates

[Next.js CommerceStarter kit for high-performance commerce with Shopify.byâ–² Vercel](/templates/next.js/nextjs-commerce)

[Next.js BoilerplateGet started with Next.js and React in seconds.byâ–² Vercel](/templates/next.js/nextjs-boilerplate)

[Platforms Starter KitNext.js template for building multi-tenant applications with custom domains using App Router, Vercel Postgres, and the Vercel Domains API.byâ–² Vercel](/templates/next.js/platforms-starter-kit)

[Virtual Event Starter KitJumpstart your virtual event and scale to any size with Next.js and Vercel.byâ–² Vercel](/templates/next.js/virtual-event-starter-kit)

## Unleash New Possibilities

Deploy your app on Vercel and unlock its full potential

## Products

* [AI](/ai)
* [Enterprise](/enterprise)
* [Fluid Compute](/fluid)
* [Next.js](/solutions/nextjs)
* [Observability](/products/observability)
* [Previews](/products/previews)
* [Rendering](/products/rendering)
* [Security](/security)
* [Turbo](/solutions/turborepo)
* [v0](https://v0.dev/)

## Resources

* [Community](https://community.vercel.com/)
* [Docs](/docs)
* [Guides](/guides)
* [Help](/help)
* [Integrations](/integrations)
* [Pricing](/pricing)
* [Resources](/resources)
* [Solution Partners](/partners/solution-partners)
* [Templates](/templates)

## Company

* [About](/about)
* [Blog](/blog)
* [Careers](/careers)
* [Changelog](/changelog)
* [Contact Us](/contact)
* [Customers](/customers)
* [Partners](/partners)
* [Privacy Policy](/legal/privacy-policy)
* Legal

## Social

* [GitHub](https://github.com/vercel)
* [LinkedIn](https://linkedin.com/company/vercel)
* [Twitter](https://x.com/vercel)
* [YouTube](https://youtube.com/@VercelHQ)

[Loading statusâ€¦](https://vercel-status.com)